// This is your Prisma schema file
// Learn more: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==================== ENUMS ====================

enum Role {
  USER
  ADMIN
}

enum VenueType {
  FOOTBALL
  BASKETBALL
  TENNIS
  VOLLEYBALL
  BADMINTON
  TABLE_TENNIS
  OTHER
}

enum SlotStatus {
  AVAILABLE
  BOOKED
  BLOCKED
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum PaymentStatus {
  PENDING
  PAID
  REFUNDED
  FAILED
}

enum SubscriptionType {
  MONTHLY
  YEARLY
}

// ==================== MODELS ====================

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String
  phone     String?
  role      Role     @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  bookings      Booking[]
  reviews       Review[]
  subscriptions Subscription[]

  @@index([email])
  @@map("users")
}

model Venue {
  id           String     @id @default(uuid())
  name         String
  type         VenueType
  address      String
  description  String?
  pricePerHour Float
  imageUrl     String?
  amenities    String[]   @default([])
  isActive     Boolean    @default(true)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  // Relations
  slots   Slot[]
  reviews Review[]

  @@index([type])
  @@index([isActive])
  @@map("venues")
}

model Slot {
  id              String     @id @default(uuid())
  venueId         String
  date            DateTime   @db.Date
  startTime       String     // Format: "HH:mm"
  endTime         String     // Format: "HH:mm"
  status          SlotStatus @default(AVAILABLE)
  maxBookings     Int        @default(1)
  currentBookings Int        @default(0)
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt

  // Relations
  venue    Venue     @relation(fields: [venueId], references: [id], onDelete: Cascade)
  bookings Booking[]

  @@index([venueId])
  @@index([date])
  @@index([venueId, date])
  @@map("slots")
}

model Booking {
  id            String        @id @default(uuid())
  userId        String
  slotId        String
  status        BookingStatus @default(PENDING)
  totalPrice    Float
  paymentStatus PaymentStatus @default(PENDING)
  paymentId     String?
  refundAmount  Float?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  slot Slot @relation(fields: [slotId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([slotId])
  @@index([status])
  @@map("bookings")
}

model Review {
  id        String   @id @default(uuid())
  userId    String
  venueId   String
  rating    Int      // 1-5
  comment   String?  @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)
  venue Venue @relation(fields: [venueId], references: [id], onDelete: Cascade)

  @@unique([userId, venueId]) // One review per user per venue
  @@index([venueId])
  @@index([userId])
  @@map("reviews")
}

// ==================== BONUS: SUBSCRIPTIONS ====================

model Subscription {
  id         String           @id @default(uuid())
  userId     String
  type       SubscriptionType
  discount   Float            // Percentage (e.g., 0.10 = 10%)
  validFrom  DateTime
  validUntil DateTime
  isActive   Boolean          @default(true)
  createdAt  DateTime         @default(now())
  updatedAt  DateTime         @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isActive])
  @@map("subscriptions")
}
